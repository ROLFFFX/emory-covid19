lag_df_19$auto_theft_percapcensus <- (lag_df_19$auto_theft_census/lag_df_19$historical)
lag_df_19$burglary_nonres_percapcensus <- (lag_df_19$burglary_nonres_census/lag_df_19$historical)
lag_df_19$burglary_res_percapcensus <- (lag_df_19$burglary_res_census/lag_df_19$historical)
lag_df_19$homicide_percapcensus <- (lag_df_19$homicide_census/lag_df_19$historical)
lag_df_19$larceny_vehicle_percapcensus <- (lag_df_19$larceny_vehicle_census/lag_df_19$historical)
lag_df_19$larceny_nonvehicle_percapcensus <- (lag_df_19$larceny_nonvehicle_census/lag_df_19$historical)
lag_df_19$robbery_com_percapcensus <- (lag_df_19$robbery_com_census/lag_df_19$historical)
lag_df_19$robbery_ped_percapcensus <- (lag_df_19$robbery_ped_census/lag_df_19$historical)
lag_df_19$robbery_res_percapcensus <- (lag_df_19$robbery_res_census/lag_df_19$historical)
df_1718 <- lag_df_1718
df_19 <- lag_df_19
set.seed(123)
df_1718$FireY_N_fct<-as.factor(ifelse(df_1718$FireY_N==0, "NF", "F"))
df_19$FireY_N_fct<-as.factor(ifelse(df_19$FireY_N==0, "NF", "F"))
df_19 <- na.omit(df_19)
library(DMwR)
#downsample
set.seed(123)
down_train <- downSample(x = df_1718[, -ncol(df_1718)],
y = df_1718$FireY_N_fct)
table(down_train$FireY_N_fct)
rf_grid <- expand.grid(.mtry=c(5,6,7,8,9,10,11,12,13,14,15))
# Controls
oob_ctrl<-trainControl(method = "oob", savePred=T, classProb=T,summaryFunction = twoClassSummary)
#random forest
set.seed(123)
start_time <- Sys.time()
rf_model_oob<-train(Formula, data = down_train, method="rf", trControl=oob_ctrl,
metric="Sens", tuneGrid=rf_grid, na.action = na.omit)
lag_df_1718 <- read_csv("df_1718_0430.csv")
knitr::opts_chunk$set(echo = TRUE)
lag_df_1718 <- read_csv("df_1718_0430.csv")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(readr)
library(tidyquant)
library(stringi)
library(caret)
lag_df_1718 <- read_csv("df_1718_0430.csv")
lag_df_19 <- read_csv("df_19_0430.csv")
final_df <- read.csv("./final_df.csv")
drop<-c("date","Day","NGHBRHDCD","CLASSDSCRP","LIVUNITS","FLOORCOUNT","BLDGAREA","RESFLRAREA","RESYRBLT","RESSTRTYP","STRCLASS","CLASSMOD","LNDVALUE","IMPR_APPR","LANDASSESS","IMPRASSESS","LANDAPPR","PRVASSDVAL","ASSDVALYRC","ASSDPCNTCG","PRVTXBLVAL","CNTTXBLVAL","ORDNAME","ORDLINK","ORDSTATUS","CAP_number","formatted_","address","SE_A13004_003","SE_A13004_004","STATEFP", "MTFCC","FUNCSTAT","aggregatio","HasData", "sourceCoun", "Year", "manslaughter", "manslaughter_census", "January","Feburary", "March", "April","May","June","July", "August","September", "October", "November", "December","X.x","X.y","X.x.x","X.y.y")
lag_df_1718<-lag_df_1718[,!(names(lag_df_1718) %in% drop)]
lag_df_19<-lag_df_19[,!(names(lag_df_19) %in% drop)]
lag_df_1718$crime_percapcensus <- (lag_df_1718$total_crime_census/lag_df_1718$historical)
lag_df_1718$agg_assault_percapcensus <- (lag_df_1718$agg_assault_census/lag_df_1718$historical)
lag_df_1718$auto_theft_percapcensus <- (lag_df_1718$auto_theft_census/lag_df_1718$historical)
lag_df_1718$burglary_nonres_percapcensus <- (lag_df_1718$burglary_nonres_census/lag_df_1718$historical)
lag_df_1718$burglary_res_percapcensus <- (lag_df_1718$burglary_res_census/lag_df_1718$historical)
lag_df_1718$homicide_percapcensus <- (lag_df_1718$homicide_census/lag_df_1718$historical)
lag_df_1718$larceny_vehicle_percapcensus <- (lag_df_1718$larceny_vehicle_census/lag_df_1718$historical)
lag_df_1718$larceny_nonvehicle_percapcensus <- (lag_df_1718$larceny_nonvehicle_census/lag_df_1718$historical)
lag_df_1718$robbery_com_percapcensus <- (lag_df_1718$robbery_com_census/lag_df_1718$historical)
lag_df_1718$robbery_ped_percapcensus <- (lag_df_1718$robbery_ped_census/lag_df_1718$historical)
lag_df_1718$robbery_res_percapcensus <- (lag_df_1718$robbery_res_census/lag_df_1718$historical)
lag_df_19$crime_percapcensus <- (lag_df_19$total_crime_census/lag_df_19$historical)
lag_df_19$agg_assault_percapcensus <- (lag_df_19$agg_assault_census/lag_df_19$historical)
lag_df_19$auto_theft_percapcensus <- (lag_df_19$auto_theft_census/lag_df_19$historical)
lag_df_19$burglary_nonres_percapcensus <- (lag_df_19$burglary_nonres_census/lag_df_19$historical)
lag_df_19$burglary_res_percapcensus <- (lag_df_19$burglary_res_census/lag_df_19$historical)
lag_df_19$homicide_percapcensus <- (lag_df_19$homicide_census/lag_df_19$historical)
lag_df_19$larceny_vehicle_percapcensus <- (lag_df_19$larceny_vehicle_census/lag_df_19$historical)
lag_df_19$larceny_nonvehicle_percapcensus <- (lag_df_19$larceny_nonvehicle_census/lag_df_19$historical)
lag_df_19$robbery_com_percapcensus <- (lag_df_19$robbery_com_census/lag_df_19$historical)
lag_df_19$robbery_ped_percapcensus <- (lag_df_19$robbery_ped_census/lag_df_19$historical)
lag_df_19$robbery_res_percapcensus <- (lag_df_19$robbery_res_census/lag_df_19$historical)
df_1718 <- lag_df_1718
df_19 <- lag_df_19
set.seed(123)
df_1718$FireY_N_fct<-as.factor(ifelse(df_1718$FireY_N==0, "NF", "F"))
df_19$FireY_N_fct<-as.factor(ifelse(df_19$FireY_N==0, "NF", "F"))
df_19 <- na.omit(df_19)
library(DMwR)
#downsample
set.seed(123)
down_train <- downSample(x = df_1718[, -ncol(df_1718)],
y = df_1718$FireY_N_fct)
table(down_train$FireY_N_fct)
rf_grid <- expand.grid(.mtry=c(5,6,7,8,9,10,11,12,13,14,15))
# Controls
oob_ctrl<-trainControl(method = "oob", savePred=T, classProb=T,summaryFunction = twoClassSummary)
#random forest
set.seed(123)
start_time <- Sys.time()
rf_model_oob<-train(Formula, data = down_train, method="rf", trControl=oob_ctrl,
metric="Sens", tuneGrid=rf_grid, na.action = na.omit)
df_1718$FireY_N_fct
set.seed(123)
start_time <- Sys.time()
rf_model_oob<-train(Formula, data = down_train, method="rf", trControl=oob_ctrl,
metric="Sens", tuneGrid=rf_grid, na.action = na.omit)
vars <- c("ES_NAME + MS_NAME + HS_NAME + ALAND + n_private + n_public+
total_crime + agg_assault + auto_theft + burglary_nonres + burglary_res +
homicide + larceny_vehicle + larceny_nonvehicle + robbery_com + robbery_ped +
robbery_res + total_crime_census + agg_assault_census + auto_theft_census +
burglary_nonres_census + burglary_res_census + homicide_census + larceny_vehicle_census +
larceny_nonvehicle_census + robbery_com_census + robbery_ped_census + robbery_res_census +
dawn + day + afternoon + night + working_wo + illegal_ro+
parking + illegal_au + illegal_fe+
zoning_oth + junk_trash + junk_vehic+
junk_tires + overgrowth + vacant_lot+
interior_s + exterior_s + damaged_ac+
parking_on + property_m + open_and_v+
raw_sewage + no_heat + no_power+
no_water + flooding + exposed_wi+
burnt_stru + highly_haz +
totalpop + popdensity+
landarea + n_hh + n_hh_fam+
n_hh_fam_married + n_hh_fam_other + n_hh_fam_nowife+
n_hh_fam_nohusband + n_hh_nonfam + n_hh_nonfam_male+
n_hh_nonfam_female + renter_units + renter_units_1per+
renter_units_2per + renter_units_3per + renter_units_4per+
renter_units_5per + renter_units_6per + renter_units_7moreper+
occ_units + occ_units_15_24 + occ_units_25_34+
occ_units_35_44 + occ_units_45_54 + occ_units_55_59+
occ_units_60_64 + occ_units_65_74 + occ_units_75_84+
occ_units_85up + pop_25up + pop_25up_lesshs+
pop_25up_hsgrad + pop_25up_somecollege + pop_25up_college+
pop_25up_masters + pop_25up_profschool + pop_25up_phd+
civpop_16to19 + civpop_16to19_hsdropout + civpop_16to19_inhsorgrad+
pop_16up + pop_16up_labor + pop_16up_military+
pop_16up_civlabor + pop_16up_civemployed + pop_16up_civunemploy+
+pop_16up_nonlabor + hh_under10k + hh_10k_15k+
hh_15k_20k + hh_20k_25k + hh_25k_30k+
hh_30k_35k + hh_35k_40k + hh_40k_45k+
hh_45k_50k + hh_50k_60k + hh_60k_75k+
hh_75k_100k + hh_100k_125k + hh_125k_150k+
hh_150k_200k + hh_over200k + median_hh_income+
mean_hh_income + agg_hh_income + n_hh_retireincome+
n_hh_noretireincome + percap_income + housing_units+
vacant_units + vacant_units_forrent + vacant_units_forsale+
vacant_units_other + median_year_built + occ_units_gas+
occ_units_electric + occ_units_fueloil + occ_units_coalwood+
occ_units_solar + occ_units_otherfuel + occ_units_nofuel+
owner_occ_units + owner_occ_units_under20k + owner_occ_units_20k_50k+
owner_occ_units_50k_100k + owner_occ_units_100k_150k + owner_occ_units_150k_300k+
owner_occ_units_300k_500k + owner_occ_units_500k_750k + owner_occ_units_750k_1mil+
owner_occ_units_over1mil + median_value + renter_units_cashrent+
renter_units_under300 + renter_units_300_599 + renter_units_600_799+
renter_units_800_999 + renter_units_1k_1249 + renter_units_1250_1499+
renter_units_1.5k_2k + renter_units_over2k + median_gross_rent+
mean_gross_rent + agg_gross_rent + p_hh_fam+
p_hh_fam_married + p_hh_fam_other + p_hh_fam_nowife+
p_hh_fam_nohusband + p_hh_nonfam + p_hh_nonfam_male+
p_hh_nonfam_female + p_renter_units_1per + p_renter_units_2per+
p_renter_units_3per + p_renter_units_4per + p_renter_units_5per+
p_renter_units_6per + p_renter_units_7moreper + p_occ_units_15_24+
p_occ_units_25_34 + p_occ_units_35_44 + p_occ_units_45_54+
p_occ_units_55_59 + p_occ_units_60_64 + p_occ_units_65_74+
p_occ_units_75_84 + p_occ_units_85up + p_pop_25up_lesshs+
p_pop_25up_hsgrad + p_pop_25up_somecollege + p_pop_25up_college+
p_pop_25up_masters + p_pop_25up_profschool + p_pop_25up_phd+
p_civpop_16to19_hsdropout + p_pop_16up_labor + p_pop_16up_military+
p_pop_16up_civlabor + p_pop_16up_civemployed + p_pop_16up_civunemploy+
p_pop_16up_nonlabor + p_hh_under10k + p_hh_10k_15k+
p_hh_15k_20k + p_hh_20k_25k + p_hh_25k_30k+
p_hh_30k_35k + p_hh_35k_40k + p_hh_40k_45k+
p_hh_45k_50k + p_hh_50k_60k + p_hh_60k_75k+
p_hh_75k_100k + p_hh_100k_125k + p_hh_125k_150k+
p_hh_150k_200k + p_hh_over200k + p_hh_retireincome")
Formula <- formula(paste("FireY_N_fct ~ ", vars))
set.seed(123)
start_time <- Sys.time()
rf_model_oob<-train(Formula, data = down_train, method="rf", trControl=oob_ctrl,
metric="Sens", tuneGrid=rf_grid, na.action = na.omit)
drop<-c("date","Day","NGHBRHDCD","CLASSDSCRP","LIVUNITS","FLOORCOUNT","BLDGAREA","RESFLRAREA","RESYRBLT","RESSTRTYP","STRCLASS","CLASSMOD","LNDVALUE","IMPR_APPR","LANDASSESS","IMPRASSESS","LANDAPPR","PRVASSDVAL","ASSDVALYRC","ASSDPCNTCG","PRVTXBLVAL","CNTTXBLVAL","ORDNAME","ORDLINK","ORDSTATUS","CAP_number","formatted_","address","SE_A13004_003","SE_A13004_004","STATEFP", "MTFCC","FUNCSTAT","aggregatio","HasData", "sourceCoun", "Year", "manslaughter", "manslaughter_census", "January","Feburary", "March", "April","May","June","July", "August","September", "October", "November", "December","X.x","X.y","X.x.x","X.y.y")
lag_df_1718<-lag_df_1718[,!(names(lag_df_1718) %in% drop)]
lag_df_19<-lag_df_19[,!(names(lag_df_19) %in% drop)]
lag_df_1718$crime_percapcensus <- (lag_df_1718$total_crime_census/lag_df_1718$historical)
lag_df_1718$agg_assault_percapcensus <- (lag_df_1718$agg_assault_census/lag_df_1718$historical)
lag_df_1718$auto_theft_percapcensus <- (lag_df_1718$auto_theft_census/lag_df_1718$historical)
lag_df_1718$burglary_nonres_percapcensus <- (lag_df_1718$burglary_nonres_census/lag_df_1718$historical)
lag_df_1718$burglary_res_percapcensus <- (lag_df_1718$burglary_res_census/lag_df_1718$historical)
lag_df_1718$homicide_percapcensus <- (lag_df_1718$homicide_census/lag_df_1718$historical)
lag_df_1718$larceny_vehicle_percapcensus <- (lag_df_1718$larceny_vehicle_census/lag_df_1718$historical)
lag_df_1718$larceny_nonvehicle_percapcensus <- (lag_df_1718$larceny_nonvehicle_census/lag_df_1718$historical)
lag_df_1718$robbery_com_percapcensus <- (lag_df_1718$robbery_com_census/lag_df_1718$historical)
lag_df_1718$robbery_ped_percapcensus <- (lag_df_1718$robbery_ped_census/lag_df_1718$historical)
lag_df_1718$robbery_res_percapcensus <- (lag_df_1718$robbery_res_census/lag_df_1718$historical)
lag_df_19$crime_percapcensus <- (lag_df_19$total_crime_census/lag_df_19$historical)
lag_df_19$agg_assault_percapcensus <- (lag_df_19$agg_assault_census/lag_df_19$historical)
lag_df_19$auto_theft_percapcensus <- (lag_df_19$auto_theft_census/lag_df_19$historical)
lag_df_19$burglary_nonres_percapcensus <- (lag_df_19$burglary_nonres_census/lag_df_19$historical)
lag_df_19$burglary_res_percapcensus <- (lag_df_19$burglary_res_census/lag_df_19$historical)
lag_df_19$homicide_percapcensus <- (lag_df_19$homicide_census/lag_df_19$historical)
lag_df_19$larceny_vehicle_percapcensus <- (lag_df_19$larceny_vehicle_census/lag_df_19$historical)
lag_df_19$larceny_nonvehicle_percapcensus <- (lag_df_19$larceny_nonvehicle_census/lag_df_19$historical)
lag_df_19$robbery_com_percapcensus <- (lag_df_19$robbery_com_census/lag_df_19$historical)
lag_df_19$robbery_ped_percapcensus <- (lag_df_19$robbery_ped_census/lag_df_19$historical)
lag_df_19$robbery_res_percapcensus <- (lag_df_19$robbery_res_census/lag_df_19$historical)
vars <- c("ES_NAME + MS_NAME + HS_NAME + ALAND + n_private + n_public+
total_crime + agg_assault + auto_theft + burglary_nonres + burglary_res +
homicide + larceny_vehicle + larceny_nonvehicle + robbery_com + robbery_ped +
robbery_res + total_crime_census + agg_assault_census + auto_theft_census +
burglary_nonres_census + burglary_res_census + homicide_census + larceny_vehicle_census +
larceny_nonvehicle_census + robbery_com_census + robbery_ped_census + robbery_res_census +
dawn + day + afternoon + night + working_wo + illegal_ro+
parking + illegal_au + illegal_fe+
zoning_oth + junk_trash + junk_vehic+
junk_tires + overgrowth + vacant_lot+
interior_s + exterior_s + damaged_ac+
parking_on + property_m + open_and_v+
raw_sewage + no_heat + no_power+
no_water + flooding + exposed_wi+
burnt_stru + highly_haz +
totalpop + popdensity+
landarea + n_hh + n_hh_fam+
n_hh_fam_married + n_hh_fam_other + n_hh_fam_nowife+
n_hh_fam_nohusband + n_hh_nonfam + n_hh_nonfam_male+
n_hh_nonfam_female + renter_units + renter_units_1per+
renter_units_2per + renter_units_3per + renter_units_4per+
renter_units_5per + renter_units_6per + renter_units_7moreper+
occ_units + occ_units_15_24 + occ_units_25_34+
occ_units_35_44 + occ_units_45_54 + occ_units_55_59+
occ_units_60_64 + occ_units_65_74 + occ_units_75_84+
occ_units_85up + pop_25up + pop_25up_lesshs+
pop_25up_hsgrad + pop_25up_somecollege + pop_25up_college+
pop_25up_masters + pop_25up_profschool + pop_25up_phd+
civpop_16to19 + civpop_16to19_hsdropout + civpop_16to19_inhsorgrad+
pop_16up + pop_16up_labor + pop_16up_military+
pop_16up_civlabor + pop_16up_civemployed + pop_16up_civunemploy+
+pop_16up_nonlabor + hh_under10k + hh_10k_15k+
hh_15k_20k + hh_20k_25k + hh_25k_30k+
hh_30k_35k + hh_35k_40k + hh_40k_45k+
hh_45k_50k + hh_50k_60k + hh_60k_75k+
hh_75k_100k + hh_100k_125k + hh_125k_150k+
hh_150k_200k + hh_over200k + median_hh_income+
mean_hh_income + agg_hh_income + n_hh_retireincome+
n_hh_noretireincome + percap_income + housing_units+
vacant_units + vacant_units_forrent + vacant_units_forsale+
vacant_units_other + median_year_built + occ_units_gas+
occ_units_electric + occ_units_fueloil + occ_units_coalwood+
occ_units_solar + occ_units_otherfuel + occ_units_nofuel+
owner_occ_units + owner_occ_units_under20k + owner_occ_units_20k_50k+
owner_occ_units_50k_100k + owner_occ_units_100k_150k + owner_occ_units_150k_300k+
owner_occ_units_300k_500k + owner_occ_units_500k_750k + owner_occ_units_750k_1mil+
owner_occ_units_over1mil + median_value + renter_units_cashrent+
renter_units_under300 + renter_units_300_599 + renter_units_600_799+
renter_units_800_999 + renter_units_1k_1249 + renter_units_1250_1499+
renter_units_1.5k_2k + renter_units_over2k + median_gross_rent+
mean_gross_rent + agg_gross_rent + p_hh_fam+
p_hh_fam_married + p_hh_fam_other + p_hh_fam_nowife+
p_hh_fam_nohusband + p_hh_nonfam + p_hh_nonfam_male+
p_hh_nonfam_female + p_renter_units_1per + p_renter_units_2per+
p_renter_units_3per + p_renter_units_4per + p_renter_units_5per+
p_renter_units_6per + p_renter_units_7moreper + p_occ_units_15_24+
p_occ_units_25_34 + p_occ_units_35_44 + p_occ_units_45_54+
p_occ_units_55_59 + p_occ_units_60_64 + p_occ_units_65_74+
p_occ_units_75_84 + p_occ_units_85up + p_pop_25up_lesshs+
p_pop_25up_hsgrad + p_pop_25up_somecollege + p_pop_25up_college+
p_pop_25up_masters + p_pop_25up_profschool + p_pop_25up_phd+
p_civpop_16to19_hsdropout + p_pop_16up_labor + p_pop_16up_military+
p_pop_16up_civlabor + p_pop_16up_civemployed + p_pop_16up_civunemploy+
p_pop_16up_nonlabor + p_hh_under10k + p_hh_10k_15k+
p_hh_15k_20k + p_hh_20k_25k + p_hh_25k_30k+
p_hh_30k_35k + p_hh_35k_40k + p_hh_40k_45k+
p_hh_45k_50k + p_hh_50k_60k + p_hh_60k_75k+
p_hh_75k_100k + p_hh_100k_125k + p_hh_125k_150k+
p_hh_150k_200k + p_hh_over200k + p_hh_retireincome")
Formula <- formula(paste("FireY_N_fct ~ ", vars))
set.seed(123)
df_1718$FireY_N_fct<-as.factor(ifelse(df_1718$FireY_N==0, "NF", "F"))
df_19$FireY_N_fct<-as.factor(ifelse(df_19$FireY_N==0, "NF", "F"))
df_19 <- na.omit(df_19)
down_train <- downSample(x = df_1718[, -ncol(df_1718)],
y = df_1718$FireY_N_fct)
table(down_train$FireY_N_fct)
str(df_1718$FireY_N_fct)
down_train
table(down_train$FireY_N_fct)
down_train$FireY_N_fct
down_train <- downSample(x = df_1718[, -ncol(df_1718)], y = df_1718$FireY_N_fct)
table(down_train$FireY_N_fct)
down_train$FireY_N_fct
down_train$FireY_N_fct
library(DMwR)
#downsample
set.seed(123)
down_train <- downSample(x = df_1718[, -ncol(df_1718)], y = df_1718$FireY_N_fct)
table(down_train$FireY_N_fct)
df_1718$FireY_N_fct
str(df_1718$FireY_N_fct)
df_1718$FireY_N_fct <- as.numeric(df_1718$FireY_N_fct)
down_train <- downSample(x = df_1718[, -ncol(df_1718)], y = df_1718$FireY_N_fct)
table(down_train$FireY_N_fct)
df_1718$FireY_N_fct<-as.factor(ifelse(df_1718$FireY_N==0, "NF", "F"))
df_19$FireY_N_fct<-as.factor(ifelse(df_19$FireY_N==0, "NF", "F"))
df_19 <- na.omit(df_19)
down_train <- downSample(x = df_1718[, -ncol(df_1718)], y = df_1718$FireY_N_fct)
table(down_train$FireY_N_fct)
library(shiny)
library(leaflet)
library(tidyverse)
library(dplyr)
library(leaflet.extras)
library(RColorBrewer)
#tp_dissolved <- read_csv("./desktop/Capstone/tp_dissolved.csv")
setwd("/Users/starsdliu/desktop/Capstone/R Shiny")
coord_info <- read_csv("./long_lat.csv")
df_vis <- read_csv("./df_vis.csv")
df_vis <- left_join(df_vis, coord_info, by = "PARCELID")
rm(coord_info)
names(df_vis)[names(df_vis) == "coord"] <- "longitude"
names(df_vis)[names(df_vis) == "coordy"] <- "latitude"
knitr::opts_chunk$set(echo = TRUE)
library(doParallel)
library(caret)
library(randomForest)
#wtih and without 'dawn + day + afternoon + night +ES_NAME + MS_NAME + HS_NAME + ALAND + ' dummy
vars <- c(       "n_private + n_public+
ES_NAME_0 + ES_NAME_Adamsville.Miles + ES_NAME_Beecher.Hills +
ES_NAME_Benteen + ES_NAME_Bethune + ES_NAME_Bolton.Academy +
ES_NAME_Boyd + ES_NAME_Brandon + ES_NAME_Burgess.Peterson +
ES_NAME_Cascade + ES_NAME_Centennial.Place + ES_NAME_Cleveland.Avenue +
ES_NAME_Connally + ES_NAME_Continental.Colony + ES_NAME_Deerwood.Academy +
ES_NAME_Dobbs + ES_NAME_Dunbar + ES_NAME_F.L..Stanton +
ES_NAME_Fain + ES_NAME_Fickett + ES_NAME_Finch +
ES_NAME_Garden.Hills + ES_NAME_Gideons + ES_NAME_Grove.Park.Woodson +
ES_NAME_Heritage.Academy + ES_NAME_Hill.Hope + ES_NAME_Humphries +
ES_NAME_Hutchinson + ES_NAME_Jackson + ES_NAME_Jones +
ES_NAME_Kimberly + ES_NAME_Lin + ES_NAME_Morningside +
ES_NAME_Parkside + ES_NAME_Perkerson + ES_NAME_Peyton.Forest +
ES_NAME_Rivers + ES_NAME_Scott + ES_NAME_Slater +
ES_NAME_Smith + ES_NAME_Springdale.Park + ES_NAME_Stanton..D.H. +
ES_NAME_Thomasville + ES_NAME_Toomer + ES_NAME_Towns +
ES_NAME_Usher + ES_NAME_Venetian.Hills + ES_NAME_West.Manor +
ES_NAME_Whitefoord + MS_NAME_0 + MS_NAME_Brown +
MS_NAME_Bunche + MS_NAME_Coan + MS_NAME_CSK.Best +
MS_NAME_Harper.Archer + MS_NAME_Inman + MS_NAME_King +
MS_NAME_Long + MS_NAME_Price + MS_NAME_Sutton +
MS_NAME_Sylvan + MS_NAME_Young + HS_NAME_0 +
HS_NAME_Carver + HS_NAME_CSK.Best + HS_NAME_Douglass +
HS_NAME_Grady + HS_NAME_Jackson + HS_NAME_Mays +
HS_NAME_North.Atlanta + HS_NAME_South.Atlanta + HS_NAME_Therrell +
HS_NAME_Washington +
total_crime + agg_assault + auto_theft + burglary_nonres + burglary_res +
homicide + larceny_vehicle + larceny_nonvehicle + robbery_com + robbery_ped +
robbery_res +
crime_percapcensus + auto_theft_percapcensus + burglary_nonres_percapcensus +
burglary_res_percapcensus  + homicide_percapcensus +
larceny_vehicle_percapcensus +
larceny_nonvehicle_percapcensus  + robbery_com_percapcensus  + robbery_ped_percapcensus +
robbery_res_percapcensus +
total_crime_census + agg_assault_census + auto_theft_census +
burglary_nonres_census + burglary_res_census + homicide_census + larceny_vehicle_census +
larceny_nonvehicle_census + robbery_com_census + robbery_ped_census + robbery_res_census +
parcelsev +
working_wo_per + illegal_room + parking + illegal_autorep + illegal_fence +
zoning_other + junk_trash + junk_vehic+
junk_tires + overgrowth + vacant_lot+
interior_str + exterior_str + damaged_acc+
parking_on + property_maint + open_and_vac+
raw_sewage + no_heat + no_power+
no_water + flooding + exposed_wire+
burnt_stru + highly_haz +
totalpop + popdensity+
landarea + n_hh + n_hh_fam+
n_hh_fam_married + n_hh_fam_other + n_hh_fam_nowife+
n_hh_fam_nohusband + n_hh_nonfam + n_hh_nonfam_male+
n_hh_nonfam_female + renter_units + renter_units_1per+
renter_units_2per + renter_units_3per + renter_units_4per+
renter_units_5per + renter_units_6per + renter_units_7moreper+
occ_units + occ_units_15_24 + occ_units_25_34+
occ_units_35_44 + occ_units_45_54 + occ_units_55_59+
occ_units_60_64 + occ_units_65_74 + occ_units_75_84+
occ_units_85up + pop_25up + pop_25up_lesshs+
pop_25up_hsgrad + pop_25up_somecollege + pop_25up_college+
pop_25up_masters + pop_25up_profschool + pop_25up_phd+
civpop_16to19 + civpop_16to19_hsdropout + civpop_16to19_inhsorgrad+
pop_16up + pop_16up_labor + pop_16up_military+
pop_16up_civlabor + pop_16up_civemployed + pop_16up_civunemploy+
+pop_16up_nonlabor + hh_under10k + hh_10k_15k+
hh_15k_20k + hh_20k_25k + hh_25k_30k+
hh_30k_35k + hh_35k_40k + hh_40k_45k+
hh_45k_50k + hh_50k_60k + hh_60k_75k+
hh_75k_100k + hh_100k_125k + hh_125k_150k+
hh_150k_200k + hh_over200k + median_hh_income+
mean_hh_income + agg_hh_income + n_hh_retireincome+
n_hh_noretireincome + percap_income + housing_units+
vacant_units + vacant_units_forrent + vacant_units_forsale+
vacant_units_other + median_year_built + occ_units_gas+
occ_units_electric + occ_units_fueloil + occ_units_coalwood+
occ_units_solar + occ_units_otherfuel + occ_units_nofuel+
owner_occ_units + owner_occ_units_under20k + owner_occ_units_20k_50k+
owner_occ_units_50k_100k + owner_occ_units_100k_150k + owner_occ_units_150k_300k+
owner_occ_units_300k_500k + owner_occ_units_500k_750k + owner_occ_units_750k_1mil+
owner_occ_units_over1mil + median_value + renter_units_cashrent+
renter_units_under300 + renter_units_300_599 + renter_units_600_799+
renter_units_800_999 + renter_units_1k_1249 + renter_units_1250_1499+
renter_units_1.5k_2k + renter_units_over2k + median_gross_rent+
mean_gross_rent + agg_gross_rent + p_hh_fam+
p_hh_fam_married + p_hh_fam_other + p_hh_fam_nowife+
p_hh_fam_nohusband + p_hh_nonfam + p_hh_nonfam_male+
p_hh_nonfam_female + p_renter_units_1per + p_renter_units_2per+
p_renter_units_3per + p_renter_units_4per + p_renter_units_5per+
p_renter_units_6per + p_renter_units_7moreper + p_occ_units_15_24+
p_occ_units_25_34 + p_occ_units_35_44 + p_occ_units_45_54+
p_occ_units_55_59 + p_occ_units_60_64 + p_occ_units_65_74+
p_occ_units_75_84 + p_occ_units_85up + p_pop_25up_lesshs+
p_pop_25up_hsgrad + p_pop_25up_somecollege + p_pop_25up_college+
p_pop_25up_masters + p_pop_25up_profschool + p_pop_25up_phd+
p_civpop_16to19_hsdropout + p_pop_16up_labor + p_pop_16up_military+
p_pop_16up_civlabor + p_pop_16up_civemployed + p_pop_16up_civunemploy+
p_pop_16up_nonlabor + p_hh_under10k + p_hh_10k_15k+
p_hh_15k_20k + p_hh_20k_25k + p_hh_25k_30k+
p_hh_30k_35k + p_hh_35k_40k + p_hh_40k_45k+
p_hh_45k_50k + p_hh_50k_60k + p_hh_60k_75k+
p_hh_75k_100k + p_hh_100k_125k + p_hh_125k_150k+
p_hh_150k_200k + p_hh_over200k + p_hh_retireincome")
Formula <- formula(paste("FireY_N_fct ~ ", vars))
eval_classification <- function(tab) {
rand_0<-((tab[1,1]+tab[2,1])/(tab[1,1]+tab[2,2]+tab[1,2]+tab[2,1]))* ((tab[1,1]+tab[1,2])/(tab[1,1]+tab[2,2]+tab[1,2]+tab[2,1]))
rand_1<-((tab[1,2]+tab[2,2])/(tab[1,1]+tab[2,2]+tab[1,2]+tab[2,1]))* ((tab[2,1]+tab[2,2])/(tab[1,1]+tab[2,2]+tab[1,2]+tab[2,1]))
accuracy<-(tab[1,1]+tab[2,2])/(tab[1,1]+tab[2,2]+tab[1,2]+tab[2,1])
precision<-tab[1,1]/(tab[1,1]+tab[2,1])
specificity<-tab[2,2]/(tab[1,2]+tab[2,2])
sensitivity<-tab[1,1]/(tab[1,1]+tab[2,1])
kappa<-(accuracy-(rand_0+rand_1))/(1-(rand_0+rand_1))
return(list(accuracy=accuracy,precision=precision,sensitivity=sensitivity,specificity=specificity,kappa=kappa))
}
lag_df_1718 <- read.csv("df_1718_0504.csv",check.names = T)
lag_df_19 <- read.csv("df_19_0504.csv",check.names = T)
df_1718 <- lag_df_1718
df_19 <- lag_df_19
set.seed(123)
df_1718$FireY_N_fct<-as.factor(ifelse(df_1718$FireY_N==0, "NF", "F"))
df_19$FireY_N_fct<-as.factor(ifelse(df_19$FireY_N==0, "NF", "F"))
df_19 <- na.omit(df_19)
df_1718 <- na.omit(df_1718)
df_19 <- na.omit(df_19)
df_1<-df_1718[df_1718$FireY_N_fct=="F",]
df_0<-df_1718[df_1718$FireY_N_fct=="NF",]
index<-1:nrow(df_0)
sample_size<- 1766
rf_grid <- expand.grid(.mtry=c(10:30))
rf_ctrl <- trainControl(method = "oob", savePred=T, classProb=T)
cl <- makePSOCKcluster(4)
registerDoParallel(cl)
start_time <- Sys.time()
for (i in 1:5){
seed_num<-123+i
set.seed(seed_num)
sub_index <-sample(index,sample_size,replace=FALSE)
df_train <-rbind(df_1,df_0[sub_index,])
savedForest[[i]] <- randomForest(Formula, data= df_train, ntree = 100, na.action = na.omit)
result <- train(Formula, data=df_train, method="rf",ntree = 100,  trControl=rf_ctrl, tuneGrid =rf_grid, na.action = na.omit)
savedForest_caret[[i]] <- result$finalModel
}
savedForest <- list()
savedForest_caret<-list()
stopCluster(cl)
rf_grid <- expand.grid(.mtry=c(10:30))
rf_ctrl <- trainControl(method = "oob", savePred=T, classProb=T)
cl <- makePSOCKcluster(4)
registerDoParallel(cl)
start_time <- Sys.time()
for (i in 1:5){
seed_num<-123+i
set.seed(seed_num)
sub_index <-sample(index,sample_size,replace=FALSE)
df_train <-rbind(df_1,df_0[sub_index,])
savedForest[[i]] <- randomForest(Formula, data= df_train, ntree = 100, na.action = na.omit)
result <- train(Formula, data=df_train, method="rf",ntree = 100,  trControl=rf_ctrl, tuneGrid =rf_grid, na.action = na.omit)
savedForest_caret[[i]] <- result$finalModel
}
end_time <- Sys.time()
start_time - end_time
stopCluster(cl)
t <- train(Formula,df_train,method = "rpart",cp=0.002,maxdepth=4)
rpart.plot(result$finalModel)
library(rpart.plot)
rpart.plot(result$finalModel)
result$finalModel
rpart.plot(result$finalModel)
model <- train(
Formula, data = df_train,
method = "rpart",
tuneLength = 10
)
library(reprtree)
if(!('reprtree' %in% installed.packages())){
install_github('araastat/reprtree')
}
library(rpart)
rpart.plot(model$finalModel)
rpart.plot(result$finalModel)
result <- rpart(Formula, df_train)
rpart.plot(result$finalModel)
rpart.plot(result)
rf.combined <- do.call("combine",savedForest_caret)
rf.combined2 <- do.call("combine",savedForest)
varimp1<-varImp(rf.combined)
varimp1$var <- row.names(varimp1)
varimp1<-varimp1[order(-varimp1$Overall),]
library(rpart)
result <- rpart(Formula, df_train)
rpart.plot(result)
varimp2<-varImp(rf.combined2)
varimp2$var <- row.names(varimp2)
varimp2<-varimp2[order(-varimp2$Overall),]
predicted<-predict(rf.combined,df_19)
predicted1_0<-predict(rf.combined,df_19, type = "prob")
rf_cm<-table(predicted=predicted, true=df_19$FireY_N_fct)
rf_cm
setwd("~/Desktop/Rollins School of Public Health Research/Shivani - COVID-19/Dashboard/emory-covid19/build/data/rawdata")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
setwd("~/Desktop/Rollins School of Public Health Research/Shivani - COVID-19/Dashboard/emory-covid19/build/data/rawdata")
df <- read_csv("nationalraw.csv")
class(df$covidmortality)
class(df$dailycases)
